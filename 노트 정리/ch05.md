# ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ



## ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

- ì˜ˆì œ ì‹œë‚˜ë¦¬ì˜¤

  1. íšŒì›(Member)ê³¼ íŒ€(Team)ì´ ìˆìŒ

  2. íšŒì›ì€ í•˜ë‚˜ì˜ íŒ€ì—ë§Œ ì†Œì† ë¨

  3. íšŒì›ê³¼ íŒ€ì€ ë‹¤ëŒ€ì¼ ê´€ê³„

     

  **ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ëª¨ë¸ë§** 

  - íšŒì›

    ```java
    @Entity(name = "Member") // ë””í´íŠ¸ë¡œ í´ë˜ìŠ¤ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
    public class Member {
        @Id @GeneratedValue
        @Column(name = "MEMBER_ID")
        private Long id;
    
        @Column(name = "USERNAME")
        private String username;
    
        @Column(name = "TEAM_ID")
        private Long teamId;
        
        // getter,setter ...
    ```

  - íŒ€

    ```java
    @Entity
    public class Team {
        @Id
        @GeneratedValue
        @Column(name = "TEAM_ID")
        private Long id;
        private String name;
        
        // getter,setter ...
    ```

  - Main

    ```java
            try {
                // íŒ€ ì €ì¥
                Team team = new Team();
                team.setName("TeamA");
                em.persist(team);
                // íšŒì› ì €ì¥
                Member member = new Member();
                member.setUsername("member1");
                member.setTeamId(team.getId()); // teamì˜ pkë¥¼ memberì˜ TeamIdì— ë„£ìŒ
                em.persist(member);
    
                // íŠ¸ëœì§ì…˜ ì»¤ë°‹í•  ë•Œ DBì— ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ ì €ì¥
                tx.commit();
            }
    ...
    ```

  - DB

    ```sql
    SELECT * FROM MEMBER;
    SELECT * FROM TEAM ;
    
    select * from member m 
         join team t on m.team_id = t.team_id;
    ```

    ![image-20210407164115213](C:\Users\thwjd\AppData\Roaming\Typora\typora-user-images\image-20210407164115213.png)

    

    - JPAê°€ `@GeneratedValue` ë””í´íŠ¸ì¸ AUTOë¡œ ì„¤ì •í•˜ì—¬ SEQUENCEë¡œ DBì— PK ì €ì¥

      ```java
      // í„°ë¯¸ë„
      Hibernate: 
          call next value for hibernate_sequence
      Hibernate: 
          call next value for hibernate_sequence
      Hibernate: 
          /* insert hellojpa.Team
              */ insert 
              into
                  Team
                  (name, TEAM_ID) 
              values
                  (?, ?)
      Hibernate: 
          /* insert hellojpa.Member
              */ insert 
              into
                  Member
                  (TEAM_ID, USERNAME, MEMBER_ID) 
              values
                  (?, ?, ?)
      ```

    - ğŸ¤·â€â™€ï¸ **ì´ ë•Œ íŠ¹ì • ë©¤ë²„ì˜ íŒ€ ì´ë¦„ì„ êµ¬í• ë ¤ë©´?**

      - main

        ```java
                    // * íŠ¹ì • ë©¤ë²„ì˜ íŒ€ êµ¬í•˜ê¸°*
                    // ì¡°íšŒ
                    Member findMember = em.find(Member.class, member.getId());
                    // ë©¤ë²„ì˜ íŒ€ ì•„ì´ë””ë¥¼ êµ¬í•˜ê¸°
                    Long findTeamId = findMember.getTeamId();
                    Team findTeam = em.find(Team.class, findTeamId);
        ```

        - í•˜ë‚˜ ì”© ìˆœì°¨ì ìœ¼ë¡œ ì°¾ì•„ê°€ì•¼ í•¨

          => ê°ì²´ì§€í–¥ìŠ¤ëŸ½ì§€ ì•ŠìŒ!

      - **ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ë°ì´í„° ì¤‘ì‹¬ìœ¼ë¡œ ëª¨ë¸ë§í•˜ë©´ í˜‘ë ¥ ê´€ê³„ë¥¼ ë§Œë“¤ ìˆ˜ x**

        - í…Œì´ë¸”ì€ ì™¸ë˜í‚¤ë¡œ ì¡°ì¸ì„ ì‚¬ìš©í•´ ì—°ê´€ëœ í…Œì´ë¸”ì„ ì°¾ìŒ
        - ë°˜ë©´, ê°ì²´ëŠ” ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ ì—°ê´€ëœ ê°ì²´ë¥¼ ì°¾ìŒ
          - ğŸ¤·â€â™€ï¸ **ì´ëŸ¬í•œ ì°¨ì´ë¥¼ ì–´ë–»ê²Œ ê·¹ë³µí•  ìˆ˜ ìˆì„ê¹Œ?**



### ê°ì²´ì§€í–¥ ìŠ¤ëŸ½ê²Œ ëª¨ë¸ë§í•˜ê¸°

- ê°ì²´ ì—°ê´€ê´€ê³„ ì‚¬ìš©: ì¡°íšŒ

- Member

  ```java
  @Entity(name = "Member") // ë””í´íŠ¸ë¡œ í´ë˜ìŠ¤ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
  public class Member {
      @Id @GeneratedValue
      @Column(name = "MEMBER_ID")
      private Long id;
  
      @Column(name = "USERNAME")
      private String username;
  
      // í•˜ë‚˜ì˜ íŒ€ì— ì—¬ëŸ¬ëª…ì˜ ë©¤ë²„ê°€ ì†Œì† ë˜ë¯€ë¡œ member : teamì€ ë‹¤ëŒ€ì¼ ê´€ê³„
      @ManyToOne
      @JoinColumn(name = "TEAM_ID") // Join í•´ì•¼í•  ì»¬ëŸ¼, TEAMì˜ PKë¥¼ ê°€ì ¸ì˜´
      private Team team;
      // getter,setter ...
  ```

  - `@xxxToxxx` ì™€ `@@JoinColumn(name = "PK")` ë¥¼ í†µí•´ ì—°ê´€ê´€ê³„ ë§Œë“¤ ìˆ˜ ìˆìŒ

- MAIN

  ```java
  try {
              // íŒ€ ì €ì¥
              Team team = new Team();
              team.setName("TeamA");
              em.persist(team);
              // íšŒì› ì €ì¥
              Member member = new Member();
              member.setUsername("ZEZE1");
              // teamì—ì„œ pkë¥¼ memberì— join í•´ì¤Œ
              member.setTeam(team);
              em.persist(member);
  
              // * íŠ¹ì • ë©¤ë²„ì˜ íŒ€ êµ¬í•˜ê¸°*
              // ì¡°íšŒ
              Member findMember = em.find(Member.class, member.getId());
              // ë©¤ë²„ì˜ íŒ€ ì•„ì´ë””ë¥¼ êµ¬í•˜ê¸°
              Team findTeam = findMember.getTeam();
              ...
  ```

  - `member.setTeam(team)`ì—ì„œ teamì˜ pkê°’ì„ memberì— join í•´ì¤Œ



- ê°ì²´ ì—°ê´€ê´€ê³„ ì‚¬ìš©: ìˆ˜ì •

  **ğŸ¤·â€â™€ï¸ íŠ¹ì • ë©¤ë²„ì˜ íŒ€ì„ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´?**

  ```java
  // DBì— 100 í‚¤ë¥¼ ê°€ì§„ TEAMì´ ìˆë‹¤ê³  ê°€ì •
  // * íŠ¹ì • ë©¤ë²„ì˜ íŒ€ ë°”ê¾¸ê¸° *
              Team newTeam = em.find(Team.class, 100L);
              findMember.setTeam(newTeam);
              em.persist(newTeam);
  ```

  

### âœ¨ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸âœ¨

- ë§¤ìš° ì¤‘ìš”âœ¨âœ¨âœ¨
- ì™œ ì–´ë ¤ìš´ê°€
  - ê°ì²´ì™€ í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ íŒ¨ëŸ¬ë‹¤ì„ì˜ ì°¨ì´ë¥¼ ì´í•´í•´ì•¼ í•¨
    - ê°ì²´ëŠ” ì°¸ì¡°ë¥¼ ì‚¬ìš©
    - í…Œì´ë¸”ì€ ì™¸ë˜í‚¤ë¥¼ í™œìš©í•´ ì¡°ì¸ì„ ì‚¬ìš©



- Team í´ë˜ìŠ¤ëŠ” Memberì™€ ì—°ê´€ëœ ì½”ë“œê°€ ì—†ìœ¼ë¯€ë¡œ 

  Member -> Team ë‹¨ë°©í–¥ ê´€ê³„

  - ë”°ë¼ì„œ `findTeam.getMember` x
  - Teamì—ë‹¤ê°€ Memberì˜ LISTë¥¼ ë„£ì–´ì¤˜ì•¼ í•¨!ğŸ’¥

- **ì–‘ë°©í–¥ ë§¤í•‘ì„ í•´ë³´ì**

  - Team

    ```java
    ...
    @OneToMany(mappedBy = "team") // Memberì— ìˆëŠ” teamê³¼ ë§µí•‘ì´ ë˜ì–´ ìˆìŒì„ ì•Œë ¤ì¤Œ
        private List<Member> members = new ArrayList<>(); // ? ArrayListë¡œ ì´ˆê¸°í™”í•´ì£¼ë©´ ì‚½ì…í•  ë•Œ nullì´ ì•ˆ ëœ¸
    ...
    ```

    `mappedBy` ì´í•´í•˜ê¸° ì§± ì–´ë ¤ì›€

    

    ### ê°ì²´ì™€ í…Œì´ë¸”ì´ ê´€ê³„ë¥¼ ë§ºëŠ” ì°¨ì´

    - ê°ì²´ ì—°ê´€ê´€ê³„ëŠ” 2ê°œ

      - íšŒì› -> íŒ€ (ë‹¨ë°©í–¥)

      - íŒ€ -> íšŒì› (ë‹¨ë°©í–¥)

        - ã„´ã…‡ã„± ì•„ë‹ˆ, ìœ„ì—ì„œëŠ” ì–‘ë°©í–¥ ë§¤í•‘ì´ë¼ë§¤! ğŸ˜£

          => ì–µì§€ë¡œ ì–‘ë°©í–¥ì´ë¼ê³  í•œ ê²ƒ!

    - í…Œì´ë¸” ì—°ê´€ê´€ê³„ëŠ” 1ê°œ

      - íšŒì› <-> íŒ€ (ì–‘ë°©í–¥)

        - ì™¸ë˜í‚¤(`MEMBER.TEAM_ID`)ë¡œ ë‘ í…Œì´ë¸”ì´ ì—°ê´€ê´€ê³„ë¥¼ ê°€ì§

          ```sql
          SELECT *
          FROM MEMBER M
          JOIN TEAM T ON M.TEAM_ID = T.TEAM_ID
          
          SELECT *
          FROM TEAM T
          JOIN MEMBER M ON T.TEAM_ID = M.TEAM_ID
          ```

          - ì™¸ë˜í‚¤ í•˜ë‚˜ë¡œ ì–‘ìª½ ì¡°ì¸ ê°€ëŠ¥

          

    - **ğŸ¤·â€â™€ï¸ ê°ì²´ëŠ” ì™¸ë˜í‚¤ ëª» ë§Œë“œë‚˜? **



## ì—°ê´€ê´€ê³„ ì£¼ì¸(Owner)

- **ì–‘ë°©í–¥ ë§¤í•‘ ê·œì¹™**
  - ê°ì²´ì˜ ë‘ ê´€ê³„ ì¤‘ í•˜ë‚˜ë§Œ ì—°ê´€ê´€ê³„ ì£¼ì¸ìœ¼ë¡œ ì§€ì •
  - ì£¼ì¸ë§Œì´ ì™¸ë˜ í‚¤ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •)
  - âœ¨ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥âœ¨
  - ì£¼ì¸ì€ `mappedBy` ì‚¬ìš© x
    - ë‚´ê°€ -ì— ì˜í•´ì„œ(By) ë§µí•‘ ë˜ì—ˆìœ¼ë¯€ë¡œ ì£¼ì¸ì´ x
  - ì£¼ì¸ì´ ì•„ë‹ˆë©´ `mappedBy` ì†ì„±ìœ¼ë¡œ ì£¼ì¸ ì§€ì •

- Team

  ```java
  @OneToMany(mappedBy = "team") 
      private List<Member> members = new ArrayList<>();
  ```

  mappedBy ì‚¬ìš© í–ˆìœ¼ë¯€ë¡œ ì£¼ì¸ì€ Member

  - ë”°ë¼ì„œ Teamì€ members ë“±ë¡, ìˆ˜ì •x

    ì½ê¸°ë§Œ ê°€ëŠ¥

- Member

  ```java
   @ManyToOne
      @JoinColumn(name = "TEAM_ID") // Join í•´ì•¼í•  ì»¬ëŸ¼, TEAMì˜ PKë¥¼ ê°€ì ¸ì˜´
      private Team team;
  ```

  Memberì˜ teamì„ ìˆ˜ì •í•˜ë©´ Teamì˜ mebersê°€ ë°˜ì˜ë¨



- ğŸ¤·â€â™€ï¸ **ì£¼ì¸ì„ ì •í•˜ëŠ” ê¸°ì¤€ì€ ë¬´ì—‡ì¼ê¹Œ?**

  - ì™¸ë˜í‚¤ê°€ ìˆëŠ” ê³³ì„ ì£¼ì¸ìœ¼ë¡œ ì§€ì •í•  ê²ƒ âœ¨

    - **Member.team**ì´ ì™¸ë˜í‚¤ì´ë¯€ë¡œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(ì§„ì§œ ë§¤í•‘)

    - **Team.members**ì€ `mappedBy`ë¡œ ì£¼ì¸ì˜ ë°˜ëŒ€í¸(ê°€ì§œ ë§¤í•‘)

      - **Team.members**ë¥¼ ì£¼ì¸ìœ¼ë¡œ ì§€ì •í•  ê²½ìš°

         **Team.members**ë¥¼ ìˆ˜ì •í•˜ë©´ Member í…Œì´ë¸”ì— ì—…ë°ì´íŠ¸ ì¿¼ë¦¬ê°€ ë‚ ë¼ê°€ê²Œ ë˜ë¯€ë¡œ ê°œë°œìê°€ í—·ê°ˆë¦¬ê³  ì„±ëŠ¥ ì´ìŠˆê°€ ë°œìƒ 



### ì–‘ë°©í–¥ ë§¤í•‘ ì‹œ ê°€ì¥ ë§ì´ í•˜ëŠ” ì‹¤ìˆ˜

- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— ê°’ì„ ì…ë ¥í•˜ì§€ ì•ŠìŒ

  ```java
              Team team = new Team();
              team.setName("TeamA");
              em.persist(team);
  
              Member member = new Member();
              member.setName("member1");
  
              // team(ì£¼ì¸ì´ ì•„ë‹Œ ë°©í–¥)ë§Œ ì—°ê´€ê´€ê³„ ì„¤ì •
              team.getMembers().add(member);
              em.persist(member);
  ```

  - DBì— `TEAM_ID`ê°€ nullë¡œ ì €ì¥ ë¨

    - `team.getMembers().add(member);` 

      ì£¼ì¸ ë¨¼ì € not ì£¼ì¸ì—ì„œ ê°’ ì„¤ì • í•´ì•¼í•¨

- ìˆ˜ì •

  ```java
              Team team = new Team();
              team.setName("TeamA");
              em.persist(team);
  
              Member member = new Member();
              member.setName("member1");
  
              // ì—°ê´€ê´€ê³„ ì£¼ì¸ì— ê°’ ì„¤ì •
              member.setTeam(team); //âœ¨âœ¨âœ¨ ì¤‘ìš”
              em.persist(member);
  		   team.getMembers().add(member);
  ```

  - ì–‘ìª½ì— ê°’ì„ ì¶”ê°€í•´ì£¼ëŠ”ê²Œ í¸í•¨!

    (ë…œ...? ğŸ¤¦â€â™€ï¸)

    - `team.getMembers().add(member);` ë¥¼ ë¹¼ë„ `TEAM_ID`ê°€ nullì´ ë˜ì§€ ì•Šì§€ë§Œ

      ê·¸ëŸ¼ì—ë„ ë„£ëŠ” ì´ìœ !

      - `em.persist(team)`ê°€ 1ì°¨ ìºì‹œì— ìˆìŒ

        ì´ ë•ŒëŠ” teamì— member ì—†ëŠ” ìƒíƒœ

      - `em.persist(member)`ì„ í•œ í›„ì— team ì¶œë ¥í•´ë³´ë©´ member ì•„ë¬´ê²ƒë„ ì¶œë ¥ x

        - `em.persist(team)` ë¥¼ í†µí•´ 1ì°¨ ìºì‹œ ì €ì¥ëœ teamì´ ì¶œë ¥ ë˜ê¸° ë•Œë¬¸!

    - ê·¸ëƒ¥ ë§˜ í¸í•˜ê²Œ ë‘ ê°œ ë‹¤ ì¶”ê°€í•˜ì...ğŸ˜‚

  - ê²°ë¡ 

    - 1ì°¨ ìºì‹œì— ë“¤ì–´ê°€ëŠ” ìˆœìˆ˜ ê°ì²´ ìƒíƒœë¥¼ ê³ ë ¤í•´ì„œ í•­ìƒ ì–‘ìª½ì— ê°’ì„ ì„¤ì •í•˜ì

    - ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ìƒì„±í•˜ì

      ```java
      // Member
      ...
          public void setTeam(Team team) {
              this.team = team;
              team.getMembers().add(this);
          }
      ...
      ```

      - Mainì—ì„œ `team.getMembers().add(member);`ëŠ” ì‚­ì œí•˜ë©´ ë¨

      - setTeam()ì€ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œì„ì„ ì•Œì•„ë³´ê¸° í˜ë“œë¯€ë¡œ

        `changeTeam()` ì™€ ê°™ì´ ì´ë¦„ì„ ë³€ê²½í•´ì£¼ì!
        
      - ğŸ’¥ ì£¼ì˜
      
        ì–‘ë°©í–¥ ë§¤í•‘ì‹œì— ë¬´í•œ ë£¨í”„ê°€ ìƒê¸¸ ìˆ˜ ìˆìŒ
      
        - lombokì—ì„œ toString() ì“°ì§€ ë§ê¸°
        - controllerì—ì„œ ì—”í‹°í‹° ë°˜í™˜í•˜ì§€ ë§ê¸° âœ¨



### ì–‘ë°©í–¥ ë§¤í•‘ ì •ë¦¬

- ë‹¨ë°©í–¥ ë§¤í•‘ë§Œìœ¼ë¡œë„ ì´ë¯¸ ì—°ê´€ê´€ê³„ ë§¤í•‘ì€ ì™„ë£Œ

  - ì–‘ë°©í–¥ ë§¤í•‘ì€ ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì—ì„œ(ë°˜ëŒ€ ë°©í–¥) ì¡°íšŒë¥¼ í•˜ê¸° ìœ„í•´ ì¶”ê°€ ëœ ê²ƒ

- ì‹¤ë¬´ì—ì„œëŠ” JPQLë¡œ ì—­ë°©í–¥ìœ¼ë¡œ íƒìƒ‰í•  ì¼ì´ ë§ìŒ

- ë‹¨ë°©í–¥ ë§¤í•‘ìœ¼ë¡œ ë‹¤ ëë‚¸ë‹¤ ìƒê°í•˜ê³ , ì–‘ë°©í–¥ì€ í•„ìš”í•  ë•Œ ì¶”ê°€í•˜ì

  

