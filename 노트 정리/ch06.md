# 다양한 연관관계 매핑





### 연관관계 매핑시 고려사항

1. 다중성 - 앞글자가 연관관계 주인 ex. 다대일의 연관관계 주인은 다

   - 다대일: @ManyToOne => 제일 많이 씀
   - 일대다: @OneToMany => 권장하지 않는 모델
   - 일대일: @OneToOne
   - 다대다: @ManyToMany => 실무에서 절대 사용 🙅‍♀️
     - 쓰지 말아야할 이유
       - 다대다 사이에 두 테이블의 기본키를 합쳐서 새로운 테이블을 만들어야 함
       
         두 테이블은 새로운 테이블의 기본키를 외래키로 가짐

2. 단/양방향

   - 양쪽이 서로 참조할시 양방향

     - but, 객체는 참조가 2개이므로 엄밀히 말해서 객체는 양방향이란 개념이 x

       (A객체 -> B객체, B객체 -> A객체)

3. 연관관계의 주인

   - 외래키를 관리하는 객체

   - 객체 양방향 관계일시 참조가 2군데이므로 둘 중 하나의 테이블에 외래키를 관리할 곳이 필요



### 일대다

- Team을 일, Member를 다 지정해도 테이블에서는 무조건 다 쪽에 외래키가 있음
- 객체와 테이블이 외래키를 갖는 방향이 달라짐
- 다대일 양방향 매핑을 사용하자 🙌



### 일대일

- 주 테이블(외래키를 가진 테이블)이나 대상 테이블 중에 외래 키 선택 가능

- 주 테이블의 객체가 연관 관계 주인이면 **일대일 단방향**

  - 다대일 단뱡향 매핑과 똑같음

- 외래키에 데이터베이스 유니크(UNI) 제약조건 추가

  - 추가 안 해도 되지만 관리하기 어려움

- **일대일 단방향 예시**

  - Member(연관 관계 주인) : Locker = 1 : 1

    - Member

      ```java
          @OneToOne
          @JoinColumn(name = "LOCKED_ID")
          private Locker locker;
      ```

    - Locker

      ```java
      @Entity
      public class Locker {
          @Id @GeneratedValue
          private Long id;
          private String name;
      
          // 양방향 관계 만들기
          @OneToOne(mappedBy = "locker") // Member에 있는 locker
          private Member member;
      }
      ```

    - 주테이블을 Member로 지정한 이유
    
      비즈니스 로직에서 Member는 자주 조회되므로 Locker도 함께 조회 돼서 Locker를 조회할 횟수가 적어짐
    
  - 🤷‍♀️ 그럼 일대일 양방향은 뭘까?

    Locker가 주테이블임에도 Member가 연관관계 주인인 상황

    - 단방향이 제일 좋지만 양방향을 사용할 경우도 많음



	###  일대일 정리

1. 주 테이블에 외래 키(일대일 단방향)
   - 장점
     1. 주 테이블만 조회해도 대상 테이블에 데이터가 있는지 확인 가능
     2. JPA 매핑 편리
   - 단점
     - 값이 없으면 외래키에 null 허용
       - 예) member 중에 locker를 안 쓰는 member는 외래키가 null 임
2. 대상 테이블에 외래 키(일대일 양방향)
   - 장점: 주 테이블과 대상 테이블이 일대일에서 일대다 관계로 변경해도 테이블 구조 유지
   - 단점: 프록시 기능의 한계로 지연 로딩으로 설정해도 항상 즉시 로딩됨

